/* =============================================================================
   Simon UI — Theme, Layout, Board, and Leaderboard Styles
   ---------------------------------------------------------------------------
   Goals:
   - Modern, glassy panels with strong contrast and subtle depth.
   - Responsive three-column layout that collapses gracefully on small screens.
   - Accessible controls (focus rings), readable typography, and motion-respect.
   - Container-query–driven leaderboard that adapts to available width.
   - Central Simon board with rim, cross dividers, glowing hub LED, and pad states.
   ============================================================================= */

/* === Theme & base === */
/* Base box sizing for predictable layout. */
* { box-sizing: border-box; }

/* Root theme tokens: colors, shadows, component sizes. */
:root{
  color-scheme: dark light;
  --bg:#0b0f14; --panel:#0e1420; --panel-2:#121a29; --text:#e5e7eb; --muted:#9ca3af;
  --accent:#22d3ee; --ring:#60a5fa; --shadow:0 10px 30px rgba(0,0,0,.35);

  /* Board geometry: pad & board sizing scale with viewport, with upper bounds. */
  --pad-size:min(36vmin,360px);
  --board-size:calc(var(--pad-size)*2 + 24px);
  --divider:clamp(10px,1.4vmin,16px);
  --rim:clamp(14px,1.8vmin,22px);

  --active-brighten:1.3; /* how much pads brighten when active */
}

/* Automatic light-mode palette. */
@media (prefers-color-scheme: light){
  :root{ --bg:#f6f9ff; --panel:#fff; --panel-2:#f1f5ff; --text:#1f2937; --muted:#6b7280; --accent:#0ea5e9; --ring:#2563eb; }
}

/* Full-height canvas for radial backgrounds. */
html,body{ height:100%; }

/* Page background with layered radial gradients; 3-row app shell (header / main / footer). */
body{
  margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  background:
    radial-gradient(1200px 600px at 10% -20%, var(--panel-2), transparent),
    radial-gradient(800px 400px at 110% 0%, rgba(96,165,250,.08), transparent),
    var(--bg);
  color:var(--text); display:grid; grid-template-rows:auto 1fr auto; line-height:1.45;
}

/* App chrome spacing. */
.app-header,.app-footer{ padding:16px clamp(16px,6vw,36px); }
.app-header h1{ margin:0 0 4px; letter-spacing:.5px; }
.tagline{ margin:0; color:var(--muted); font-size:.95rem; }

/* === 3-column layout === */
/* Max width centered grid with fixed rails and flexible center column. */
.layout-3{
  max-width:1400px; margin:0 auto; padding:16px clamp(16px,6vw,36px) 32px;
  display:grid; grid-template-columns:minmax(280px,360px) minmax(560px,1fr) minmax(280px,360px);
  gap:clamp(20px,4vw,40px); align-items:start;
}

/* Make inner panels sticky near viewport top for persistent HUD on tall pages. */
.col .sticky{ position:sticky; top:18px; }

/* Collapse to single-column on narrow screens; disable sticky to avoid awkward overlap. */
@media (max-width: 900px){
  .layout-3{ grid-template-columns:1fr; }
  .col .sticky{ position:static; }
}

/* Cards / panels */
/* Subtle glassmorphism: gradient overlay + background blur + soft border/shadow. */
.hud,.card{
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.06)), var(--panel-2);
  border-radius:16px; padding:14px; box-shadow:var(--shadow);
  border:1px solid rgba(255,255,255,.08);
  backdrop-filter:saturate(1.2) blur(6px);
  display:grid; gap:12px;
}

/* Fallback for browsers without backdrop-filter. */
@supports not (backdrop-filter: blur(6px)){
  .hud,.card{ background:var(--panel-2); } /* graceful fallback */
}

/* Light mode tweaks: subtler borders. */
@media (prefers-color-scheme: light){ .hud,.card{ border-color:rgba(0,0,0,.06); } }

.hud-row{ display:flex; justify-content:space-between; align-items:baseline; gap:12px; }
.round-display{ font-weight:700; letter-spacing:.6px; }

/* Name field block. */
.name-row{ display:grid; gap:6px; }
.name-row input{
  width:100%; background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.12); color:var(--text);
  border-radius:10px; padding:8px 10px; outline:none;
}
.name-row input:focus{ box-shadow:0 0 0 3px rgba(96,165,250,.35); border-color:var(--ring); }

/* Main controls row (start/end, clear, etc.). */
.controls{ display:flex; gap:8px; justify-content:center; }

/* Primary and ghost buttons with small motion and elevation. */
.btn{
  appearance:none; border:none; background:var(--accent); color:#031018;
  padding:8px 14px; border-radius:10px; font-weight:700; cursor:pointer;
  box-shadow:0 6px 18px rgba(34,211,238,.35);
  transition:transform .06s ease, box-shadow .12s ease, opacity .2s ease;
}
.btn:hover{ transform:translateY(-1px); }
.btn:active{ transform:translateY(0); }
.btn[disabled]{ opacity:.5; cursor:not-allowed; }
.btn--ghost{ background:transparent; color:var(--text); border:1px solid rgba(255,255,255,.2); box-shadow:none; }
.btn--tiny{ padding:6px 10px; font-size:.9rem; }
.btn:focus-visible{ outline:2px solid var(--ring); outline-offset:2px; }

/* Toggle groups (labels/sound/strict/stats). */
.toggles{ display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }
.toggle{ display:inline-flex; align-items:center; gap:8px; }
.toggle input{ width:18px; height:18px; }

/* Audio/volume row, responsive wrapping. */
.av-row{ display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
.vol{ display:grid; gap:4px; min-width:160px; }
.vol input[type="range"]{ width:160px; } /* predictable slider width */
.tone{ display:flex; gap:10px; align-items:center; border:0; padding:0; margin:0; }
.tone legend{ font-size:.9rem; color:var(--muted); margin-right:4px; }

/* Secondary text styles. */
.small,.mini{ color:var(--muted); font-size:.9rem; }
.hint{ min-height:1.2em; } /* reserves space so layout doesn’t jump when hint appears */

/* lone stats toggle positioned under the mini line */
.toggle--below{ justify-self:center; margin-top:-2px; }

/* Stats */
/* Head spacing + compact grid for meter + sparkline card. */
.stats-card .card-head{ margin-bottom:4px; }
.stats-grid{ display:grid; gap:12px; }
.meter-head{ display:flex; align-items:center; justify-content:space-between; }

/* Accuracy meter (progress bar). */
.meter-bar{ height:10px; border-radius:999px; overflow:hidden; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.1); }
.meter-fill{ height:100%; background:linear-gradient(90deg,#22d3ee,#60a5fa); width:0%; transition:width .2s ease; }

/* ========================================================================== */
/*                               LEADERBOARD                                  */
/* ========================================================================== */

/* Header controls line. */
.card-head{ display:flex; justify-content:space-between; align-items:center; }
.card-head h3{ margin:0; font-size:1.05rem; }

/* Shared grid: header + rows use SAME columns. */
.leaderboard{
  --lb-rank-col: 3.2ch;                      /* up to 2–3 digits */
  --lb-score-col: clamp(180px, 42%, 240px);  /* pills + time */
  container-type:inline-size;                /* enables container queries below */
}

/* Define three-column grid for both header and each row. */
.leaderboard .lb-headers,
.leaderboard .lb-list li{
  display:grid;
  grid-template-columns: var(--lb-rank-col) minmax(0,1fr) var(--lb-score-col);
  align-items:center;
  gap:12px;
}

/* Header row */
.leaderboard .lb-headers{
  padding:0 0 6px;
  border-bottom:1px solid rgba(255,255,255,.1);
}
.leaderboard .lb-headers span:nth-child(1){ justify-self:center; font-variant-numeric:tabular-nums; }
.leaderboard .lb-headers span:nth-child(2){ justify-self:start; }
.leaderboard .lb-headers span:nth-child(3){ justify-self:end; }

/* List baseline */
.leaderboard .lb-list{
  list-style:none; margin:0; padding:0; display:grid; gap:6px;
}

/* Rows */
.leaderboard .lb-list li{
  padding:6px 8px; border-radius:10px;
  transition:background .15s ease, border-color .15s ease;
}
/* Hover glow for discoverability. */
.leaderboard .lb-list li:hover{ background:rgba(255,255,255,.04); }
/* Visual highlight for freshly added score (JS toggles .is-new briefly). */
.leaderboard .lb-list li.is-new{
  background:linear-gradient(180deg, rgba(34,211,238,.10), rgba(34,211,238,.06));
  border:1px solid rgba(34,211,238,.22);
}

/* Cells */
.leaderboard .lb-list li { align-items:start; }
.leaderboard .rank{ justify-self:center; opacity:.9; font-variant-numeric:tabular-nums; }
.leaderboard .who{
  min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.leaderboard .score{
  justify-self:end; display:flex; align-items:flex-start; gap:8px; flex-wrap:wrap; text-align:right;
}
.leaderboard .score .lb-chip{ line-height:1; }

/* Time label styles; spans full width below chips on small lines. */
.leaderboard .lb-time{
  margin-left:8px; opacity:.7; white-space:nowrap;
  font-weight:600; font-size:.85rem;
  font-variant-numeric:tabular-nums; font-feature-settings:"tnum" 1;
  line-height:1.1; display:block; width:100%; margin-top:4px; text-align:right;
}

/* Medal accent for top 3 */
.rank.rank-1{ color:#fbbf24; font-weight:800; }
.rank.rank-2{ color:#9ca3af; font-weight:800; }
.rank.rank-3{ color:#d97706; font-weight:800; }

/* Chips */
/* Compact, high-contrast pills for round, accuracy, and mode. */
.lb-chip{
  display:inline-block; padding:3px 8px; border-radius:999px; font-weight:700; font-size:.9rem;
  background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12);
}
.lb-round{ background:rgba(99,102,241,.15); border-color:rgba(99,102,241,.35); }
.lb-acc  { background:rgba(34,197,94,.15);  border-color:rgba(34,197,94,.35); }
.lb-mode { background:rgba(255,255,255,.08); border-color:rgba(255,255,255,.18); }
.lb-mode--strict{ background:rgba(239,68,68,.18);  border-color:rgba(239,68,68,.40); }
.lb-mode--normal{ background:rgba(34,197,94,.16);  border-color:rgba(34,197,94,.35); }

/* ========================== Container-query responsiveness ================== */
/* The leaderboard adapts to the width of its container, not the viewport. */

/* Narrow leaderboard: give name real space, wrap chips, hide time */
@container (max-width: 420px){
  .leaderboard .lb-time{ display:none !important; }
  .leaderboard .lb-headers,
  .leaderboard .lb-list li{
    grid-template-columns: 3ch minmax(8rem,1fr) minmax(6.5rem, max-content);
    align-items:start; gap:8px;
  }
  .leaderboard .who{
    min-width:0; white-space:normal; overflow:hidden; text-overflow:ellipsis;
    overflow-wrap:anywhere;
    display:-webkit-box; -webkit-box-orient:vertical;
    -webkit-line-clamp:2; line-clamp:2;
  }
  .leaderboard .score{ flex-wrap:wrap; gap:6px; }
  .leaderboard .lb-chip{ padding:2px 6px; font-size:.85rem; }
}

/* Extra-narrow cards */
@container (max-width: 340px){
  .leaderboard .lb-headers,
  .leaderboard .lb-list li{ grid-template-columns: 2.8ch 1fr max-content; }
  .leaderboard .lb-chip{ font-size:.8rem; padding:1px 5px; }
}

/* Minimal viewport fallback for browsers without container queries */
@supports not (container-type: inline-size){
  @media (max-width: 1200px){
    .leaderboard .lb-time{ display:none !important; }
    .leaderboard .lb-headers,
    .leaderboard .lb-list li{
      grid-template-columns: 3ch minmax(10rem,1fr) minmax(6.5rem,max-content);
      align-items:start; gap:10px;
    }
    .leaderboard .who{
      min-width:0; white-space:normal; overflow:hidden; text-overflow:ellipsis; overflow-wrap:anywhere;
      display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:2; line-clamp:2;
    }
  }
}

/* Optional: if you have very long single-word names, ensure they can break by default */
.leaderboard .who{ overflow-wrap:anywhere; }

/* ========================================================================== */
/*                        Round Simon board (center)                           */
/* ========================================================================== */

/* Center column keeps content centered; small gap for status/help. */
.col-center{ display:grid; justify-items:center; gap:16px; }

/* Circular board with inner glow, rim, and subtle texture. */
.board{
  justify-self:center;
  width:min(100%, var(--board-size));
  height:auto;
  aspect-ratio:1 / 1;
  position:relative; border-radius:50%; overflow:hidden;
  background:
    radial-gradient(60% 60% at 50% 50%, rgba(255,255,255,.05), transparent 60%),
    radial-gradient(100% 100% at 50% 50%, #0b1018, #06090f 70%);
  box-shadow: inset 0 0 0 var(--rim) #0a0e14, 0 14px 26px rgba(0,0,0,.45);
  border:1px solid rgba(255,255,255,.06);
}
/* Cross dividers */
.board::before,.board::after{ content:""; position:absolute; background:#0a0e14; z-index:2; }
.board::before{ top:0; bottom:0; left:50%; width:var(--divider); transform:translateX(-50%); }
.board::after { left:0; right:0; top:50%; height:var(--divider); transform:translateY(-50%); }

/* Hub + LED */
/* Center hub with inner disc and drop shadow to simulate depth. */
.hub{
  position:absolute; inset:50% auto auto 50%; transform:translate(-50%,-50%);
  width:36%; height:36%; border-radius:50%;
  background: radial-gradient(90% 90% at 30% 30%, rgba(255,255,255,.06), transparent 60%), #0c121c;
  border:1px solid rgba(255,255,255,.08);
  box-shadow: inset 0 0 22px rgba(0,0,0,.6), 0 8px 18px rgba(0,0,0,.35);
  z-index:3; display:grid; place-items:center;
}
.hub-inner{
  width:80%; height:80%; border-radius:50%;
  background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.2));
  border:1px solid rgba(255,255,255,.06);
  display:grid; place-items:center; gap:6px;
}

/* LED indicator synced to gameplay via class toggles. */
.hub-led{
  width:14px; height:14px; border-radius:50%;
  background: radial-gradient(60% 60% at 40% 40%, #bdeafe, #1fa3ff 70%, #0b77d1);
  box-shadow:0 0 10px rgba(80,180,255,.65);
  opacity:.85; transition:transform .15s ease, opacity .2s ease, filter .2s ease;
}
.hub-led.is-breathing{ animation:hub-breathe 1.9s ease-in-out infinite; }
.hub-led.is-blink{ animation:hub-blink .25s ease-out; }
@keyframes hub-breathe{ 0%{transform:scale(1);filter:brightness(1)} 50%{transform:scale(1.12);filter:brightness(1.25)} 100%{transform:scale(1);filter:brightness(1)} }
@keyframes hub-blink{ 0%{filter:brightness(1)} 30%{filter:brightness(1.8)} 100%{filter:brightness(1)} }
.hub-mark{ font-weight:800; letter-spacing:3px; font-size:clamp(12px,2.4vmin,20px); color:rgba(255,255,255,.85); opacity:.85; }

/* Pads */
/* Quadrant buttons with radial gloss; absolute positioning fills the four quarters. */
.pad{
  position:absolute; width:50%; height:50%; border:none; outline:none; cursor:pointer;
  display:grid; place-items:center; transition:transform .12s ease, filter .12s ease, box-shadow .12s ease, opacity .2s ease;
  z-index:1;
}
/* Focus ring for keyboard users. */
.pad:focus-visible{ box-shadow:0 0 0 4px var(--ring); }

/* Color quadrants with subtle highlight to give volume. */
.pad--green{ top:0; left:0; background:radial-gradient(140% 100% at 20% 20%, rgba(255,255,255,.28), transparent 50%), #16a34a; }
.pad--red{ top:0; left:50%; background:radial-gradient(140% 100% at 20% 20%, rgba(255,255,255,.28), transparent 50%), #dc2626; }
.pad--yellow{ top:50%; left:50%; background:radial-gradient(140% 100% at 20% 20%, rgba(255,255,255,.28), transparent 50%), #f59e0b; }
.pad--blue{ top:50%; left:0; background:radial-gradient(140% 100% at 20% 20%, rgba(255,255,255,.28), transparent 50%), #2563eb; }

/* Active state: brighter, slightly larger, inner glow. */
.pad.is-active{ filter:brightness(var(--active-brighten)) saturate(1.25); transform:scale(1.02); box-shadow:inset 0 0 28px rgba(255,255,255,.18); }

/* Labels (arrows) */
/* Optional big arrows/letters on pads; toggled via .labels-on on <body>. */
.pad-key{
  font-size:clamp(28px,8vmin,54px); line-height:1; font-weight:900;
  color:rgba(255,255,255,.95); text-shadow:0 2px 6px rgba(0,0,0,.45), 0 0 1px rgba(0,0,0,.7);
  user-select:none; pointer-events:none; display:none;
}
.labels-on .pad .pad-key{ display:block; }
@media (prefers-color-scheme: light){
  .pad-key{ color:rgba(0,0,0,.85); text-shadow:0 2px 6px rgba(0,0,0,.1), 0 0 1px rgba(255,255,255,.7); }
}

/* Center status pill + Help */
/* Non-intrusive status chip and a help box under the board. */
.status-pill{
  text-align:center; padding:8px 12px; border-radius:999px;
  background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12);
  box-shadow:var(--shadow); color:var(--text); min-height:1.4em;
}
.help{
  width:min(820px, 100%);
  background:rgba(0,0,0,.18); border:1px solid rgba(255,255,255,.08);
  padding:14px 16px; border-radius:12px;
}

/* Reduced motion */
/* Respect user preference: remove animations and transitions where possible. */
@media (prefers-reduced-motion: reduce){
  .pad,.btn{ transition:none; }
  .pad.is-active{ transform:none; }
  .hub-led.is-breathing,.hub-led.is-blink{ animation:none !important; }
}

/* Screen reader live region */
/* Utility to visually hide but keep content accessible to screen readers. */
.sr-only{
  position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0);
  white-space:nowrap; border:0;
}

/* === Wide-screen & overlap fixes === */
/* Let the board grow a bit on very wide screens; fine-tune hub and dividers. */
@media (min-width: 1200px){
  .col-center .board{ max-width: 700px; }
}
@media (min-width: 1400px){
  .hub{ width: 32%; height: 32%; }
  .board::before{ width: 12px; }
  .board::after{  height: 12px; }
  .layout-3{
    max-width: 1560px;
    grid-template-columns: minmax(320px,400px) minmax(560px,1fr) minmax(320px,400px);
    gap: clamp(28px, 5vw, 60px);
  }
  .col-center{ gap: 12px; }
  .help{ margin-top: 4px; }
}

/* Ensure leaderboard sits above nearby overlapping elements (e.g., shadows). */
.col-right .card{ position: relative; z-index: 5; }

/* Optional page-level layout shift to avoid rail crush */
/* Between tablet and small-desktop, drop right column below for more room. */
@media (max-width: 1200px) and (min-width: 901px){
  .layout-3{ grid-template-columns: minmax(280px,360px) 1fr; } /* left + center */
  .col-right{ grid-column: 1 / -1; } /* leaderboard below, full width */
  .col .sticky{ position: static; }
}
